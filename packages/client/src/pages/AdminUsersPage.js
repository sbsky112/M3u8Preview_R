import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Users, Heart, ListVideo, Clock } from 'lucide-react';
import { adminApi } from '../services/adminApi.js';
export function AdminUsersPage() {
    const [page, setPage] = useState(1);
    const [search, setSearch] = useState('');
    const queryClient = useQueryClient();
    const { data, isLoading } = useQuery({
        queryKey: ['admin', 'users', page, search],
        queryFn: () => adminApi.getUsers(page, 20, search || undefined),
    });
    const updateMutation = useMutation({
        mutationFn: ({ id, payload }) => adminApi.updateUser(id, payload),
        onSuccess: () => queryClient.invalidateQueries({ queryKey: ['admin', 'users'] }),
    });
    const deleteMutation = useMutation({
        mutationFn: (id) => adminApi.deleteUser(id),
        onSuccess: () => queryClient.invalidateQueries({ queryKey: ['admin', 'users'] }),
    });
    return (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "flex items-center justify-between flex-wrap gap-4", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx(Users, { className: "w-6 h-6 text-emby-text-secondary" }), _jsx("h1", { className: "text-2xl font-bold text-white", children: "\u7528\u6237\u7BA1\u7406" })] }), _jsx("input", { type: "text", value: search, onChange: e => setSearch(e.target.value), placeholder: "\u641C\u7D22\u7528\u6237\u540D\u6216\u90AE\u7BB1...", className: "px-4 py-2 bg-emby-bg-input border border-emby-border rounded-lg text-white text-sm placeholder-emby-text-muted focus:outline-none focus:ring-2 focus:ring-emby-green w-64" })] }), _jsx("div", { className: "bg-emby-bg-card border border-emby-border-subtle rounded-lg overflow-x-auto", children: _jsxs("table", { className: "w-full text-sm", children: [_jsx("thead", { children: _jsxs("tr", { className: "border-b border-emby-border-subtle", children: [_jsx("th", { className: "px-4 py-3 text-left text-emby-text-secondary font-medium", children: "\u7528\u6237\u540D" }), _jsx("th", { className: "px-4 py-3 text-left text-emby-text-secondary font-medium", children: "\u90AE\u7BB1" }), _jsx("th", { className: "px-4 py-3 text-left text-emby-text-secondary font-medium", children: "\u89D2\u8272" }), _jsx("th", { className: "px-4 py-3 text-left text-emby-text-secondary font-medium", children: "\u72B6\u6001" }), _jsx("th", { className: "px-4 py-3 text-left text-emby-text-secondary font-medium", children: "\u7EDF\u8BA1" }), _jsx("th", { className: "px-4 py-3 text-left text-emby-text-secondary font-medium", children: "\u6CE8\u518C\u65F6\u95F4" }), _jsx("th", { className: "px-4 py-3 text-left text-emby-text-secondary font-medium", children: "\u64CD\u4F5C" })] }) }), _jsx("tbody", { children: isLoading ? (Array.from({ length: 5 }).map((_, i) => (_jsx("tr", { className: "border-b border-emby-border-subtle/50", children: _jsx("td", { colSpan: 7, className: "px-4 py-3", children: _jsx("div", { className: "h-5 bg-emby-bg-input rounded animate-pulse" }) }) }, i)))) : data?.items?.map((user) => (_jsxs("tr", { className: "border-b border-emby-border-subtle/50 hover:bg-emby-bg-input/30", children: [_jsx("td", { className: "px-4 py-3 text-white font-medium", children: user.username }), _jsx("td", { className: "px-4 py-3 text-emby-text-secondary", children: user.email }), _jsx("td", { className: "px-4 py-3", children: _jsxs("select", { value: user.role, onChange: e => updateMutation.mutate({ id: user.id, payload: { role: e.target.value } }), className: "bg-emby-bg-input text-white text-xs px-2 py-1 rounded border border-emby-border", children: [_jsx("option", { value: "USER", children: "USER" }), _jsx("option", { value: "ADMIN", children: "ADMIN" })] }) }), _jsx("td", { className: "px-4 py-3", children: _jsx("button", { onClick: () => updateMutation.mutate({ id: user.id, payload: { isActive: !user.isActive } }), className: `px-2 py-0.5 rounded text-xs ${user.isActive ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`, children: user.isActive ? '活跃' : '禁用' }) }), _jsxs("td", { className: "px-4 py-3 text-emby-text-muted text-xs", children: [_jsxs("span", { className: "inline-flex items-center gap-0.5", children: [_jsx(Heart, { className: "w-3 h-3" }), user._count?.favorites || 0] }), ' ', _jsxs("span", { className: "inline-flex items-center gap-0.5", children: [_jsx(ListVideo, { className: "w-3 h-3" }), user._count?.playlists || 0] }), ' ', _jsxs("span", { className: "inline-flex items-center gap-0.5", children: [_jsx(Clock, { className: "w-3 h-3" }), user._count?.watchHistory || 0] })] }), _jsx("td", { className: "px-4 py-3 text-emby-text-muted text-xs", children: new Date(user.createdAt).toLocaleDateString('zh-CN') }), _jsx("td", { className: "px-4 py-3", children: user.role !== 'ADMIN' && (_jsx("button", { onClick: () => {
                                                if (confirm(`确定要删除用户 ${user.username} 吗？`)) {
                                                    deleteMutation.mutate(user.id);
                                                }
                                            }, className: "text-red-400 hover:text-red-300 text-xs", children: "\u5220\u9664" })) })] }, user.id))) })] }) }), data && data.totalPages > 1 && (_jsxs("div", { className: "flex items-center justify-center gap-2", children: [_jsx("button", { onClick: () => setPage(Math.max(1, page - 1)), disabled: page === 1, className: "px-4 py-2 bg-emby-bg-input text-white rounded-lg disabled:opacity-50 hover:bg-emby-bg-elevated text-sm", children: "\u4E0A\u4E00\u9875" }), _jsxs("span", { className: "text-emby-text-secondary text-sm", children: [page, " / ", data.totalPages] }), _jsx("button", { onClick: () => setPage(Math.min(data.totalPages, page + 1)), disabled: page === data.totalPages, className: "px-4 py-2 bg-emby-bg-input text-white rounded-lg disabled:opacity-50 hover:bg-emby-bg-elevated text-sm", children: "\u4E0B\u4E00\u9875" })] }))] }));
}
